angular.module("app",["ui.router","ui.bootstrap","ui-notification","smart-table","googlechart","ngDreamFactory"]);var app=angular.module("app").constant("DSP_URL","https://dream-wshd.rhcloud.com").constant("DSP_API_KEY","uagb").config(["$httpProvider","DSP_API_KEY",function(e,t){}]).config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function(e,t,n,o){app.controller=e.register,app.directive=t.directive,app.filter=n.register,app.factory=o.factory,app.service=o.service,app.constant=o.constant,app.value=o.value}]);angular.module("app").run(["$rootScope","$state","$stateParams","DreamFactory",function(e,t,n,o){e.$state=t,e.$stateParams=n,e.df=o,e.$on("$stateChangeError",function(e){e.preventDefault(),sessionStorage.setItem("stateToGo",""),t.go("access.login")})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){var n=["Auth",function(e){return e.currentUser()}];t.otherwise("/app/history"),e.state("app",{"abstract":!0,url:"/app",templateUrl:"assets/tpl/app.html",resolve:{authenticated:n}}).state("app.orders",{url:"/orders",templateUrl:"assets/tpl/order/list.html",controller:"ListOrderCtrl"}).state("app.history",{url:"/history",templateUrl:"assets/tpl/order/history.html",controller:"HistoryOrderCtrl"}).state("app.clients",{url:"/clients",templateUrl:"assets/tpl/client/list.html",controller:"ListClientCtrl"}).state("app.regions",{url:"/regions",templateUrl:"assets/tpl/region/list.html",controller:"RegionCtrl"}).state("access",{url:"/access",template:'<div ui-view class="fade-in-right-big smooth"></div>'}).state("access.login",{url:"/login",templateUrl:"assets/tpl/login.html",controller:"LoginCtrl"}).state("access.logout",{url:"/logout",template:"<div ui-view></div>",controller:"LogoutCtrl"}).state("music",{url:"/music",templateUrl:"tpl/music.html",controller:"MusicCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster","com.2fdevs.videogular.plugins.buffering","js/app/music/ctrl.js","js/app/music/theme.css"])}]}}).state("music.home",{url:"/home",templateUrl:"tpl/music.home.html"}).state("music.genres",{url:"/genres",templateUrl:"tpl/music.genres.html"}).state("music.detail",{url:"/detail",templateUrl:"tpl/music.detail.html"}).state("music.mtv",{url:"/mtv",templateUrl:"tpl/music.mtv.html"}).state("music.mtvdetail",{url:"/mtvdetail",templateUrl:"tpl/music.mtv.detail.html"}).state("music.playlist",{url:"/playlist/{fold}",templateUrl:"tpl/music.playlist.html"})}]),angular.module("app").controller("AppCtrl",["$scope","$window","$filter","$state","Notification",function(e,t,n,o,i){function r(e){var t=e.navigator.userAgent||e.navigator.vendor||e.opera;return/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(t)}function a(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("Registration worked!")})["catch"](function(e){console.log("Registration failed! "+e)})}var l=!!navigator.userAgent.match(/MSIE/i);l&&angular.element(t.document.body).addClass("ie"),r(t)&&angular.element(t.document.body).addClass("smart"),a(),e.app={name:"UA-GB",version:"1.0.4(30.09.2017)",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:1,navbarHeaderColor:"bg-info dker",navbarCollapseColor:"bg-info dker",asideColor:"bg-light dker b-r",headerFixed:!0,asideHide:!0,asideFixed:!0,asideFolded:!1,asideDock:!0,container:!0,itemsPerPage:25},Notification:i,showCharts:!0,selDate:n("date")(new Date,"yyyy-MM-dd"),regions:[],selRegion:{}},e.SelectedRegionId=function(){return(e.app.selRegion||{}).id},e.SelectRegion=function(t){e.app.selRegion=(e.app.selRegion||{}).id==t.id?{}:t,e.$broadcast("regionchange")},e.goHome=function(){e.app.selDate=n("date")(new Date,"yyyy-MM-dd"),e.app.selRegion={},o.go("app.history")},e.print=function(){t.print()},e.toggleCharts=function(){e.app.showCharts=!e.app.showCharts}}]),app.controller("LoginCtrl",["$scope","Auth",function(e,t){e.authError="",e.user={},e.login=function(){t.login(e.user).then(function(t){var n=sessionStorage.getItem("stateToGo");e.$state.go(n?n:"app.history")},function(t){console.log(t),e.authError=t})}}]),app.controller("LogoutCtrl",["$scope","Auth",function(e,t){t.logout().then(function(){e.regions=[],e.$state.go("access.login")},function(e){console.log(e)})}]),app.controller("ListClientCtrl",["$scope","$http","$modal","Storage","Notify",function(e,t,n,o,i){var r="client";e.isLoading=!0,e.$on("api:ready",function(){c()});var a=function(e){return e.map(function(e){return e.orders_int=parseInt(e.orders),e})},l=function(t){e.clients=a(t)},c=function(){o.getSP("clients_with_totals").then(function(t){l(t),e.isLoading=!1},function(t){console.log("Clients loading failed. "+t),u("list",null),e.isLoading=!1}),o.get("region").then(function(t){e.regions=t},function(e){console.log("Regions loading failed. "+e)})},s=function(){localforage.getItem("clients_with_totals").then(function(t){l(t),null!=t&&(e.isLoading=!1),c()})["catch"](function(){c()})};s();var u=function(e,t){var n={list:"Помилка при завантаженні клієнтів!",add:"Помилка при додаванні!",edit:"Помилка при збереженні!","delete":"Помилка при видаленні!"};i.error(r,e,t,n[e])},d=function(e,t){var n={add:"Клієнта було успішно додано!",edit:"Клієнта було успішно збережено!","delete":"Клієнта було успішно видалено!"};i.success(r,e,t,n[e])};e.isUnchanged=function(){return angular.equals(e.prevClient,e.clientToEdit)},e.add=function(){var t="add";e.clientToEdit={isNew:!0,region_id:0},e.prevClient=angular.copy(e.clientToEdit);var i=n.open({templateUrl:"assets/tpl/client/edit.html",scope:e});i.result.then(function(e){o.insert(r,e).then(function(n){c(),d(t,e.name)},function(n){console.log("Client "+t+" failed. "+n),u(t,e.name)})})},e.edit=function(t){var i="edit";e.clientToEdit=angular.copy(t),e.clientToEdit.region_id=parseInt(e.clientToEdit.region_id),e.clientToEdit.isNew=!1,e.prevClient=angular.copy(e.clientToEdit);var a=n.open({templateUrl:"assets/tpl/client/edit.html",scope:e});a.result.then(function(e){o.update(r,e).then(function(t){c(),d(i,e.name)},function(t){console.log("Client "+i+" failed. "+t),u(i,e.name)})})},e["delete"]=function(t){var i="delete";e.clientToDelete=t;var a=n.open({templateUrl:"assets/tpl/client/delete.confirm.html",scope:e});a.result.then(function(e){o["delete"](r,e.id).then(function(t){c(),d(i,e.name)},function(t){console.log("Client "+i+" failed. "+t),u(i,e.name)})})}}]),app.controller("ListOrderCtrl",["$scope","$filter","$modal","Storage","Notify",function(e,t,n,o,i){var r="order",a=!0,l=!0,c=!1;e.isLoading=!0,e.$on("api:ready",function(){w()}),e.$on("regionchange",function(){T()});var s=function(t){angular.forEach(t,function(e,t){e._bags=angular.fromJson(e.bags),e._goods=angular.fromJson(e.goods)}),e.orders=t,T()},u=function(t){e.app.regions=t,k()},d=function(t){e.regions=t},p=function(t){e.clients=t},f=function(){if(window.navigator.onLine){var t=[{name:"sel_date",param_type:"date",value:e.app.selDate}];o.getSP_params("orders_by_date",t).then(function(e){s(e),a=!1,C()},function(e){console.log("Orders loading failed. "+e),R("list",null),a=!1,C()})}else a=!1,C()},g=function(){window.navigator.onLine&&o.get("region").then(function(e){d(e)},function(e){console.log("Regions loading failed. "+e)})},m=function(){if(window.navigator.onLine){var t=[{name:"sel_date",param_type:"date",value:e.app.selDate}];o.getSP_params("region_orders_by_date",t).then(function(e){u(e),l=!1,C()},function(e){console.log("Orders loading failed. "+e),R("list",null),l=!1,C()})}else l=!1,C()},v=function(){window.navigator.onLine?o.getSP("clients_with_totals").then(function(e){p(e),c=!1,C()},function(e){console.log("Clients loading failed. "+e),c=!1,C()}):(c=!1,C())},h=function(){localforage.getItem("orders_by_date_"+e.app.selDate).then(function(e){s(e),null!=e&&(a=!1,C()),f()})["catch"](function(){f()})},y=function(){localforage.getItem("region").then(function(e){d(e),g()})["catch"](function(){g()})},b=function(){localforage.getItem("region_orders_by_date_"+e.app.selDate).then(function(e){u(e),null!=e&&(l=!1,C()),m()})["catch"](function(){m()})},_=function(){localforage.getItem("clients_with_totals").then(function(e){p(e),null!=e&&(c=!1,C()),v()})["catch"](function(){v()})},w=function(){f(),m(),g(),v()},$=function(){h(),b(),y(),_()};$();var C=function(){e.isLoading=a||l||c},T=function(){e.filteredOrders=(e.app.selRegion||{}).id>0?e.orders.filter(function(t){return t.region_id==e.app.selRegion.id}):e.orders,e.regionName=(e.app.selRegion||{}).name||"Всі",e.regionOrders=(e.app.selRegion||{}).order_amount||E(),e.regionWeight=(e.app.selRegion||{}).order_total_weight||S()},E=function(){var t=0,n=e.app.regions||[],o=n.length,i=0;for(t;o>t;t++)i+=parseInt(n[t].order_amount)||0;return i},S=function(){var t=0,n=e.app.regions||[],o=n.length,i=0;for(t;o>t;t++)i+=parseInt(n[t].order_total_weight)||0;return i},k=function(){var t=[];e.chart={},e.chart.type="BarChart",angular.forEach(e.app.regions,function(e){var n={c:[]};n.c.push({v:e.name}),n.c.push({v:e.order_amount}),n.c.push({v:e.order_total_weight}),t.push(n)}),e.chart.data={cols:[{id:"r",label:"Region",type:"string"},{id:"a",label:"Кількість",type:"number"},{id:"w",label:"Вага (кг)",type:"number"}],rows:t},e.chart.options={colors:["#f05050","#16aad8"],isStacked:"true",chartArea:{left:"150",right:"15",top:"10",width:"100%",height:"80%"},legend:{position:"bottom"}}},R=function(e,t){var n={list:"Помилка при завантаженні замовлень!",add:"Помилка при додаванні!",edit:"Помилка при збереженні!","delete":"Помилка при видаленні!"};i.error(r,e,t,n[e])},P=function(e,t){var n={add:"Замовлення було успішно додано!",edit:"Замовлення було успішно збережено!","delete":"Замовлення було успішно видалено!"};i.success(r,e,t,n[e])};e.open_calendar=function(t){t.preventDefault(),t.stopPropagation(),e.calendar_opened=!0},e.client_selected=function(t){e.orderToEdit.client_id=t.id,e.orderToEdit.address=t.address,e.orderToEdit.region_id=parseInt(t.region_id)},e.getTotalWeight=function(){return e.orderToEdit._bags.reduce(function(e,t){return parseInt(e)+parseInt(t)},0)},e.isUnchanged=function(){return angular.equals(e.prevOrder,e.orderToEdit)},e.editClient=function(){console.log(e.orderToEdit.selected_client.id);var t="edit",r="client";e.clientToEdit=e.orderToEdit.selected_client,e.clientToEdit.isNew=!1,e.clientToEdit.region_id=parseInt(e.orderToEdit.selected_client.region_id);var a=n.open({templateUrl:"assets/tpl/client/edit.html",backdrop:"static",scope:e});a.result.then(function(n){o.update(r,n).then(function(o){w(),i.success(r,t,n.name,"Клієнта було успішно збережено!"),e.orderToEdit.selected_client=angular.copy(n),e.client_selected(n)},function(e){i.error(r,t,n.name,"Помилка при збереженні!"),console.log("Client "+t+" failed. "+e)})})},e.addClient=function(){var t="add",r="client";e.clientToEdit={isNew:!0,region_id:e.orderToEdit.region_id};var a=n.open({templateUrl:"assets/tpl/client/edit.html",backdrop:"static",scope:e});a.result.then(function(n){o.insert(r,n).then(function(o){w(),i.success(r,t,n.name,"Клієнта було успішно додано!"),n.id=o.id,e.orderToEdit.selected_client=n,e.client_selected(n)},function(e){i.error(r,t,n.name,"Помилка при додаванні!"),console.log("Client "+t+" failed. "+e)})})},e.add=function(){var i="add";e.orderToEdit={isNew:!0,region_id:parseInt((e.app.selRegion||{}).id)||0,client_id:0,date:e.app.selDate,_bags:[],_goods:[]},e.prevOrder={};var a=n.open({templateUrl:"assets/tpl/order/edit.html",scope:e,size:"lg"});a.result.then(function(n){n.bags=JSON.stringify(n._bags),n.goods=JSON.stringify(n._goods),n.date=t("date")(n.date,"yyyy-MM-dd"),n.weight=e.getTotalWeight(),o.insert(r,n).then(function(e){P(i,n.number),w()},function(e){R(i,n.number),console.log("Order "+i+" failed. "+e)})})},e.edit=function(i){var a="edit";e.orderToEdit=angular.copy(i),e.orderToEdit.region_id=parseInt(e.orderToEdit.region_id),e.orderToEdit.client_id=parseInt(e.orderToEdit.client_id),e.orderToEdit.selected_client=e.clients.filter(function(t){return t.id==e.orderToEdit.client_id})[0],e.orderToEdit.isNew=!1,e.prevOrder=angular.copy(e.orderToEdit);var l=n.open({templateUrl:"assets/tpl/order/edit.html",scope:e,size:"lg"});l.result.then(function(n){n.bags=JSON.stringify(n._bags),n.goods=JSON.stringify(n._goods),n.date=t("date")(n.date,"yyyy-MM-dd"),n.weight=e.getTotalWeight(),o.update(r,n).then(function(e){P(a,n.number),w()},function(e){R(a,n.number),console.log("Order "+a+" failed. "+e)})})},e["delete"]=function(t){var i="delete";e.orderToDelete=t;var a=n.open({templateUrl:"assets/tpl/order/delete.confirm.html",scope:e});a.result.then(function(e){o["delete"](r,e.id).then(function(t){w(),P(i,e.number)},function(t){console.log("Order "+i+" failed. "+t),R(i,e.number)})})}}]),app.controller("HistoryOrderCtrl",["$scope","$state","$filter","Storage","Notify",function(e,t,n,o,i){var r={date:n("date")(new Date,"yyyy-MM-dd"),isToday:!0,amount:"0",total_weight:"0"};e.isLoading=!0,e.$on("api:ready",function(){l()});var a=function(t){s(t),t[0].date==r.date?t[0].isToday=!0:t=[r].concat(t),e.dates=t},l=function(){window.navigator.onLine?o.getSP("order_history").then(function(t){a(t),e.isLoading=!1},function(t){console.log("Order history loading failed. "+t),i.error("order","list",null,"Помилка при завантаженні історії замовлень!"),e.isLoading=!1}):e.isLoading=!1},c=function(){localforage.getItem("order_history").then(function(t){a(t),null!=t&&(e.isLoading=!1),l()})["catch"](function(){l()})};c();var s=function(t){var n=[];e.chart={},e.chart.type="LineChart",angular.forEach(t,function(e){var t={c:[]};t.c.push({v:new Date(e.date)}),t.c.push({v:e.amount}),t.c.push({v:e.total_weight}),n.push(t)}),e.chart.data={cols:[{id:"d",label:"Дата",type:"date"},{id:"a",label:"Кількість",type:"number"},{id:"w",label:"Вага (кг)",type:"number"}],rows:n},e.chart.options={colors:["#f05050","#16aad8"],isStacked:"true",chartArea:{left:"70",right:"15",top:"10",width:"100%",height:"80%"},legend:{position:"bottom"},fill:20,displayExactValues:!0}};e.selectDate=function(n){e.app.selDate=n,e.app.selRegion={},t.go("app.orders")}}]),app.controller("RegionCtrl",["$scope","$modal","Storage","Notify",function(e,t,n,o){var i="region";e.isLoading=!0,e.$on("api:ready",function(){a()});var r=function(t){e.regions=t},a=function(){n.getSP("regions_with_totals").then(function(t){r(t),e.isLoading=!1},function(t){console.log("Regions loading failed. "+t),c("list",null),e.isLoading=!1})},l=function(){localforage.getItem("regions_with_totals").then(function(t){r(t),null!=t&&(e.isLoading=!1),a()})["catch"](function(){a()})};l();var c=function(e,t){var n={list:"Помилка при завантаженні регіонів!",add:"Помилка при додаванні!",edit:"Помилка при збереженні!","delete":"Помилка при видаленні!"};o.error(i,e,t,n[e])},s=function(e,t){var n={add:"Регіон було успішно додано!",edit:"Регіон було успішно збережено!","delete":"Регіон було успішно видалено!"};o.success(i,e,t,n[e])};e.isUnchanged=function(){return angular.equals(e.prevRegion,e.regionToEdit)},e.add=function(){var o="add";e.regionToEdit={isNew:!0},e.prevRegion=angular.copy(e.regionToEdit);var r=t.open({templateUrl:"assets/tpl/region/edit.html",scope:e});r.result.then(function(e){n.insert(i,e).then(function(t){s(o,e.name),a()},function(t){c(o,e.name),console.log("Region "+o+" failed. "+t)})})},e.edit=function(o){var r="edit";e.regionToEdit=angular.copy(o),e.regionToEdit.isNew=!1,e.prevRegion=angular.copy(e.regionToEdit);var l=t.open({templateUrl:"assets/tpl/region/edit.html",scope:e});l.result.then(function(e){n.update(i,e).then(function(t){s(r,e.name),a()},function(t){c(r,e.name),console.log("Region "+r+" failed. "+t)})})},e["delete"]=function(o){var r="delete";e.regionToDelete=o;var l=t.open({templateUrl:"assets/tpl/region/delete.confirm.html",scope:e});l.result.then(function(e){n["delete"](i,e.id).then(function(t){s(r,e.name),a()},function(t){c(r,e.name),console.log("Region "+r+" failed. "+t)})})}}]),angular.module("app").directive("bagManager",function(){return{restrict:"E",scope:{bags:"=",placeholder:"@"},template:'<div class="bags"><div ng-repeat="(idx, bag) in bags track by $index" class="bag label label-info" ng-click="remove(idx)">{{bag}}<span class="glyphicon glyphicon-remove"></span></div></div><input type="text" placeholder="{{placeholder}}" ng-model="new_value" class="form-control bag-input" ></input> ',link:function(e,t){var n=angular.element(t.children()[1]);e.add=function(){e.bags.push(e.new_value),e.new_value=""},e.remove=function(t){e.bags.splice(t,1)},n.bind("keypress",function(t){""==e.new_value||13!=t.keyCode&&43!=t.keyCode?(t.keyCode<48||t.keyCode>57)&&t.preventDefault():(t.preventDefault(),e.$apply(e.add))})}}}),angular.module("app").directive("goodManager",function(){return{restrict:"E",scope:{goods:"=",typeph:"@",priceph:"@"},template:'<div class="goods"><div ng-repeat="(idx, good) in goods track by $index" class="good label label-default" ng-click="remove(idx)"><span class="glyphicon glyphicon-remove"></span><div class="good-type">{{good.type}}</div><div class="good-price">{{good.price}}</div></div></div><div class="input-group" style="clear: both;"><input type="text" class="form-control" ng-model="new_value.type" placeholder="{{typeph}}" /><span class="input-group-btn" style="width:0px;"></span><input type="text" class="form-control" ng-model="new_value.price" placeholder="{{priceph}}" style="border-left: 0" /><span class="input-group-btn"><button class="btn btn-info" ng-click="add()"><span class="glyphicon glyphicon-plus"></span></button></span></div>',link:function(e,t){e.new_value={};var n=angular.element(t[0].querySelectorAll("input"));e.add=function(){e.new_value.hasOwnProperty("type")&&e.new_value.hasOwnProperty("price")&&(e.goods.push(e.new_value),e.new_value={}),event.preventDefault()},e.remove=function(t){e.goods.splice(t,1)},n.bind("keypress",function(t){""==e.new_value.type||""==e.new_value.price||13!=t.keyCode&&43!=t.keyCode||(t.preventDefault(),e.$apply(e.add))})}}}),angular.module("app").directive("setNgAnimate",["$animate",function(e){return{link:function(t,n,o){t.$watch(function(){return t.$eval(o.setNgAnimate,t)},function(t,o){e.enabled(!!t,n)})}}}]),angular.module("app").directive("uiButterbar",["$rootScope","$anchorScroll",function(e,t){return{restrict:"AC",template:'<span class="bar"></span>',link:function(e,n,o){n.addClass("butterbar hide"),e.$on("$stateChangeStart",function(e){t(),n.removeClass("hide").addClass("active")}),e.$on("$stateChangeSuccess",function(e,t,o,i){e.targetScope.$watch("$viewContentLoaded",function(){n.addClass("hide").removeClass("active")})})}}}]),angular.module("app").directive("uiFocus",function(e,t){return{link:function(n,o,i){var r=t(i.uiFocus);n.$watch(r,function(t){t===!0&&e(function(){o[0].focus()})}),o.bind("blur",function(){n.$apply(r.assign(n,!1))})}}}),angular.module("app").directive("uiFullscreen",["uiLoad","JQ_CONFIG","$document","$window",function(e,t,n,o){return{restrict:"AC",template:'<i class="fa fa-expand fa-fw text"></i><i class="fa fa-compress fa-fw text-active"></i>',link:function(o,i,r){i.addClass("hide"),e.load(t.screenfull).then(function(){screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./)&&i.removeClass("hide"),i.on("click",function(){var e;r.target&&(e=$(r.target)[0]),screenfull.toggle(e)}),n.on(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?i.addClass("active"):i.removeClass("active")})})}}}]),angular.module("ui.jq",["ui.load"]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","JQ_CONFIG","uiLoad","$timeout",function(e,t,n,o){return{restrict:"A",compile:function(i,r){if(!angular.isFunction(i[r.uiJq])&&!t[r.uiJq])throw new Error('ui-jq: The "'+r.uiJq+'" function does not exist');var a=e&&e[r.uiJq];return function(e,i,r){function l(){var t=[];return r.uiOptions?(t=e.$eval("["+r.uiOptions+"]"),angular.isObject(a)&&angular.isObject(t[0])&&(t[0]=angular.extend({},a,t[0]))):a&&(t=[a]),t}function c(){o(function(){i[r.uiJq].apply(i,l())},0,!1)}function s(){r.uiRefresh&&e.$watch(r.uiRefresh,function(){c()})}r.ngModel&&i.is("select,input,textarea")&&i.bind("change",function(){i.trigger("input")}),t[r.uiJq]?n.load(t[r.uiJq]).then(function(){c(),s()})["catch"](function(){}):(c(),s())}}}}]),angular.module("app").directive("uiModule",["MODULE_CONFIG","uiLoad","$compile",function(e,t,n){return{restrict:"A",compile:function(o,i){var r=o.contents().clone();return function(o,i,a){i.contents().remove(),t.load(e[a.uiModule]).then(function(){n(r)(o,function(e,t){i.append(e)})})}}}}]),angular.module("app").directive("uiNav",["$timeout",function(e){return{restrict:"AC",link:function(e,t,n){var o,i=$(window),r=768,a=$(".app-aside"),l=".dropdown-backdrop";t.on("click","a",function(e){o&&o.trigger("mouseleave.nav");var t=$(this);t.parent().siblings(".active").toggleClass("active"),t.next().is("ul")&&t.parent().toggleClass("active")&&e.preventDefault(),t.next().is("ul")||i.width()<r&&$(".app-aside").removeClass("show off-screen")}),t.on("mouseenter","a",function(e){if(o&&o.trigger("mouseleave.nav"),$("> .nav",a).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||i.width()<r||$(".app-aside-dock").length)){var t,n=$(e.target),c=$(window).height(),s=50,u=150;!n.is("a")&&(n=n.closest("a")),n.next().is("ul")&&(o=n.next(),n.parent().addClass("active"),t=n.parent().position().top+s,o.css("top",t),t+o.height()>c&&o.css("bottom",0),t+u>c&&o.css("bottom",c-t-s).css("top","auto"),o.appendTo(a),o.on("mouseleave.nav",function(e){$(l).remove(),o.appendTo(n.parent()),o.off("mouseleave.nav").css("top","auto").css("bottom","auto"),n.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(e){e&&e.trigger("mouseleave.nav")}))}}),a.on("mouseleave",function(e){o&&o.trigger("mouseleave.nav"),$("> .nav",a).remove()})}}}]),angular.module("app").directive("uiScrollTo",["$location","$anchorScroll",function(e,t){return{restrict:"AC",link:function(n,o,i){o.on("click",function(n){e.hash(i.uiScrollTo),t()})}}}]),angular.module("app").directive("uiShift",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){function i(){e(function(){var e=o.uiShift,t=o.target;l.hasClass("in")||l[e](t).addClass("in")})}function r(){a&&a.prepend(n),!a&&l.insertAfter(s),l.removeClass("in")}var a,l=$(n),c=$(window),s=l.prev(),u=c.width();!s.length&&(a=l.parent()),768>u&&i()||r(),c.resize(function(){u!==c.width()&&e(function(){c.width()<768&&i()||r(),u=c.width()})})}}}]),angular.module("app").directive("uiToggleClass",["$timeout","$document",function(e,t){return{restrict:"AC",link:function(e,t,n){t.on("click",function(e){function o(e,t){for(var n=new RegExp("\\s"+e.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),o=" "+$(t)[0].className+" ";n.test(o);)o=o.replace(n," ");$(t)[0].className=$.trim(o)}e.preventDefault();var i=n.uiToggleClass.split(","),r=n.target&&n.target.split(",")||Array(t),a=0;angular.forEach(i,function(e){var t=r[r.length&&a];-1!==e.indexOf("*")&&o(e,t),$(t).toggleClass(e),a++}),$(t).toggleClass("active")})}}}]),app.service("Auth",["$q","$http","DreamFactory",function(e,t,n){var o=function(o){var i=e.defer();if(n.api.ready){var r={body:o};n.api.user.login(r,function(e){t.defaults.headers.common["X-DreamFactory-Session-Token"]=e.session_id,localforage.setItem("currentUser",e),i.resolve(e)},function(e){i.reject(e)})}return i.promise},i=function(){var o=e.defer();return n.api.ready&&n.api.user.logout({},function(e){delete t.defaults.headers.common["X-DreamFactory-Session-Token"],localforage.removeItem("currentUser"),o.resolve(e)},function(e){o.reject(e)}),o.promise},r=function(){return localforage.getItem("currentUser")};return{login:function(e){return o(e)},logout:function(){return i()},currentUser:function(){return r()}}}]),app.service("DB",["$q","$http",function(e,t){function n(e){e.error.length>0&&403==e.error[0].code&&(window.location="#/access/logout")}function o(e,o){var i=a+e;return t.post(i,o)["catch"](n)}function i(e,o){var i=a+e+"/"+o.id;return t.put(i,o)["catch"](n)}function r(e,o){var i=a+e+"/"+o;return t["delete"](i)["catch"](n)}var a="https://mintfox.com.ua/api/api.php/",l="https://mintfox.com.ua/api/sp/api.php/",c="?transform=1",s=function(e){var o=a+e+c;return t.get(o).then(function(t){return t.data[e]||[]})["catch"](n)},u=function(e){var o=l+e;return t.post(o).then(function(e){return e.data[0]||[]})["catch"](n)},d=function(e,o){var i=l+e+"?"+o[0].value,r={};return o.forEach(function(e){r[e.name]=e.value}),t({method:"POST",url:i,data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e.data[0]||[]})["catch"](n)};return{getRecords:function(e){return s(e)},callStoredProc:function(e){return u(e)},callStoredProcWithParams:function(e,t){return d(e,t)},createRecords:function(e,t){return o(e,t)},updateRecords:function(e,t){return i(e,t)},deleteRecords:function(e,t){return r(e,t)}}}]),app.service("Notify",["Notification",function(e){var t=3e3,n={list:"list",add:"plus",edit:"pencil","delete":"trash"},o={region:"direction",client:"user",order:"present"},i=function(i,r,a,l){e.success({message:'<i class="glyphicon glyphicon-'+n[r]+' bg-light bg-white-opacity wrapper-xs"></i> &nbsp; '+l,title:a?'<i class="icon-'+o[i]+' fa-fw wrapper-xs"></i> &nbsp; '+a:null,delay:t})},r=function(i,r,a,l){e.error({message:'<i class="glyphicon glyphicon-'+n[r]+' bg-light bg-white-opacity wrapper-xs"></i> &nbsp; '+l,title:a?'<i class="icon-'+o[i]+' fa-fw wrapper-xs"></i> &nbsp; '+a:null,delay:t})};return{success:function(e,t,n,o){return i(e,t,n,o)},error:function(e,t,n,o){return r(e,t,n,o)}}}]),app.service("Storage",["$q","DB","$http","Auth",function(e,t,n,o){var i=function(e){return t.getRecords(e)},r=function(e){return t.callStoredProc(e)},a=function(e,n){return t.callStoredProcWithParams(e,n)},l=function(e,n){return t.createRecords(e,n)},c=function(e,n){return t.updateRecords(e,n)},s=function(e,n){return t.deleteRecords(e,n)};return{get:function(e){return i(e)},getSP:function(e){return r(e)},getSP_params:function(e,t){return a(e,t)},insert:function(e,t){return l(e,t)},update:function(e,t){return c(e,t)},"delete":function(e,t){return s(e,t)}}}]),app.service("OldStorage",["$q","DreamFactory","$http","Auth",function(e,t,n,o){function i(e){e.error.length>0&&403==e.error[0].code&&(window.location="#/access/logout")}var r=function(){o.currentUser().then(function(e){e&&!n.defaults.headers.common["X-DreamFactory-Session-Token"]&&(n.defaults.headers.common["X-DreamFactory-Session-Token"]=e.session_id)})},a=function(n){var o=e.defer();if(t.api.ready){var r={table_name:n};t.api.uagb.getRecords(r,function(e){o.resolve(e.record)},function(e){i(e),o.reject(e)})}return o.promise},l=function(n){var o=e.defer();if(t.api.ready){var r={procedure_name:n};t.api.uagb.callStoredProc(r,function(e){o.resolve(e)},function(e){i(e),o.reject(e)})}return o.promise},c=function(n,o){var r=e.defer();if(t.api.ready){var a={procedure_name:n,body:{params:o}};t.api.uagb.callStoredProcWithParams(a,function(e){r.resolve(e)},function(e){i(e),r.reject(e)})}return r.promise},s=function(n,o){var r=e.defer();if(t.api.ready){var a={table_name:n,body:o};t.api.uagb.createRecords(a,function(e){r.resolve(e)},function(e){i(e),r.reject(e)})}return r.promise},u=function(n,o){var r=e.defer();if(t.api.ready){var a={table_name:n,body:[o]};t.api.uagb.updateRecords(a,function(e){r.resolve(e)},function(e){i(e),r.reject(e)})}return r.promise},d=function(n,o){var r=e.defer();if(t.api.ready){var a={table_name:n,ids:o};t.api.uagb.deleteRecordsByIds(a,function(e){r.resolve(e)},function(e){i(e),r.reject(e)})}return r.promise};return{get:function(e){return r(),a(e)},getSP:function(e){return r(),l(e)},getSP_params:function(e,t){return r(),c(e,t)},insert:function(e,t){return r(),s(e,t)},update:function(e,t){return r(),u(e,t)},"delete":function(e,t){return r(),d(e,t)}}}]);